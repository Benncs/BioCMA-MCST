<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BioCMAMC-ST: example_model.cxx</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BioCMAMC-ST
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search',true);
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('example_model_8cxx-example.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">example_model.cxx</div></div>
</div><!--header-->
<div class="contents">
<p>Example of minimum model declaration</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md20"></a>
UDF</h2>
<p>When Kokkos selected backend is on host, (either <em>Serial</em>, <em>OpenMP</em> or <em>Threads</em>), user-defined-model can be loaded at runtime and modified without compile the whole program. The UDF models can be program is the almost same way as regular model but with some limitations. The build can be done with the <b>udf_build</b> script, in order to select model user has to: set the model name as: <b>udf_model</b> and set the envar : <b>BIOMC_LIB_PATH</b> to the absolute .so path.</p>
<p><span class="tt">export BIOMC_LIB_PATH=$(pwd)/path/lib_udf_model_custom.so</span></p>
<p>UDF models can only be selected when the backend is set to host because the model definition and declaration are handled separately during the compilation step. The model is loaded through a shared library mechanism (e.g., dlopen on Linux), but this introduces some limitations. For instance, certain optimizations, such as the size of views, cannot be performed at runtime, which may result in slower performance in some cases. However, udf can't be used with device backend like CUDA, where the kernel must be known at compile time. While CUDA runtime can load PTX code dynamically, this would require writing and compiling CUDA code separately, which is not the intended approach in the Kokkos framework.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef __EXAMPLE_MODEL_HPP__</span></div>
<div class="line"><span class="preprocessor">#define __EXAMPLE_MODEL_HPP__</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;common/traits.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;mc/prng/prng_extension.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;mc/traits.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;models/uptake.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;models/utils.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string_view&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>ModelExample</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Define properties here, fill enum witn name</span></div>
<div class="line">  <span class="keyword">enum class</span> particle_var : <span class="keywordtype">int</span></div>
<div class="line">  {</div>
<div class="line">    mass = 0,</div>
<div class="line">    a,</div>
<div class="line">    __COUNT__ <span class="comment">// This member is recommended to automatically get the number of</span></div>
<div class="line">              <span class="comment">// defined property and there get the right size</span></div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// n_var is needed, if using __COUNT__ this line does not have to be modified</span></div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">constexpr</span> std::size_t n_var = INDEX_FROM_ENUM(particle_var::__COUNT__);</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">constexpr</span> std::string_view name =</div>
<div class="line">      <span class="stringliteral">&quot;example&quot;</span>; <span class="comment">// Name is optional refers to model name</span></div>
<div class="line"> </div>
<div class="line">  <span class="keyword">using </span>uniform_weight =</div>
<div class="line">      std::true_type; <span class="comment">//  Define this line if models works if unique weight, if</span></div>
<div class="line">                      <span class="comment">//  each MCparticle has</span></div>
<div class="line">  <span class="comment">//  specific weight comment this line</span></div>
<div class="line">  <span class="keyword">using </span>Self = ModelExample; <span class="comment">// Mandatory Type alias</span></div>
<div class="line">  <span class="keyword">using </span>FloatType = float;   <span class="comment">// Mandatory Type alias</span></div>
<div class="line">  <span class="keyword">using </span>SelfParticle =</div>
<div class="line">      <a id="_a0" name="_a0"></a><a class="code hl_typedef" href="namespaceMC.html#ae36f8da8fd9f9f88aa5cff4f307cdc68">MC::ParticlesModel&lt;Self::n_var, Self::FloatType&gt;</a>; <span class="comment">// Mandatory Type alias</span></div>
<div class="line"> </div>
<div class="line">  KOKKOS_INLINE_FUNCTION <span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">  init(<span class="keyword">const</span> <a id="_a1" name="_a1"></a><a class="code hl_typedef" href="classMC_1_1KPRNG.html#a762b10c38f7b947b5698d16cbbb008d7">MC::KPRNG::pool_type</a>&amp; random_pool,</div>
<div class="line">       std::size_t idx,</div>
<div class="line">       <span class="keyword">const</span> SelfParticle&amp; arr);</div>
<div class="line"> </div>
<div class="line">  KOKKOS_INLINE_FUNCTION <span class="keyword">static</span> <span class="keywordtype">double</span> mass(std::size_t idx,</div>
<div class="line">                                            <span class="keyword">const</span> SelfParticle&amp; arr);</div>
<div class="line"> </div>
<div class="line">  KOKKOS_INLINE_FUNCTION <span class="keyword">static</span> <a id="_a2" name="_a2"></a><a class="code hl_enumeration" href="namespaceMC.html#a69467f7d54b0dcb1a4e176fe425ffb7b">MC::Status</a></div>
<div class="line">  update(<span class="keyword">const</span> <a class="code hl_typedef" href="classMC_1_1KPRNG.html#a762b10c38f7b947b5698d16cbbb008d7">MC::KPRNG::pool_type</a>&amp; random_pool,</div>
<div class="line">         FloatType d_t,</div>
<div class="line">         std::size_t idx,</div>
<div class="line">         <span class="keyword">const</span> SelfParticle&amp; arr,</div>
<div class="line">         <span class="keyword">const</span> <a id="_a3" name="_a3"></a><a class="code hl_typedef" href="namespaceMC.html#aad69f7f73ef6a017ee86ca89451a6271">MC::LocalConcentration</a>&amp; c);</div>
<div class="line"> </div>
<div class="line">  KOKKOS_INLINE_FUNCTION <span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">  division(<span class="keyword">const</span> <a class="code hl_typedef" href="classMC_1_1KPRNG.html#a762b10c38f7b947b5698d16cbbb008d7">MC::KPRNG::pool_type</a>&amp; random_pool,</div>
<div class="line">           std::size_t idx,</div>
<div class="line">           std::size_t idx2,</div>
<div class="line">           <span class="keyword">const</span> SelfParticle&amp; arr,</div>
<div class="line">           <span class="keyword">const</span> SelfParticle&amp; buffer_arr);</div>
<div class="line"> </div>
<div class="line">  KOKKOS_INLINE_FUNCTION <span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">  contribution(std::size_t idx,</div>
<div class="line">               std::size_t position,</div>
<div class="line">               <span class="keywordtype">double</span> weight,</div>
<div class="line">               <span class="keyword">const</span> SelfParticle&amp; arr,</div>
<div class="line">               <span class="keyword">const</span> <a id="_a4" name="_a4"></a><a class="code hl_typedef" href="namespaceMC.html#aa1b418b6e151ebc14d95164d7370e35b">MC::ContributionView</a>&amp; contributions);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">CHECK_MODEL(ModelExample)</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="ttc" id="aclassMC_1_1KPRNG_html_a762b10c38f7b947b5698d16cbbb008d7"><div class="ttname"><a href="classMC_1_1KPRNG.html#a762b10c38f7b947b5698d16cbbb008d7">MC::KPRNG::pool_type</a></div><div class="ttdeci">MC::pool_type pool_type</div><div class="ttdef"><b>Definition</b> prng.hpp:38</div></div>
<div class="ttc" id="anamespaceMC_html_a69467f7d54b0dcb1a4e176fe425ffb7b"><div class="ttname"><a href="namespaceMC.html#a69467f7d54b0dcb1a4e176fe425ffb7b">MC::Status</a></div><div class="ttdeci">Status</div><div class="ttdef"><b>Definition</b> alias.hpp:49</div></div>
<div class="ttc" id="anamespaceMC_html_aa1b418b6e151ebc14d95164d7370e35b"><div class="ttname"><a href="namespaceMC.html#aa1b418b6e151ebc14d95164d7370e35b">MC::ContributionView</a></div><div class="ttdeci">decltype(Kokkos::Experimental::create_scatter_view(kernelContribution())) ContributionView</div><div class="ttdef"><b>Definition</b> alias.hpp:76</div></div>
<div class="ttc" id="anamespaceMC_html_aad69f7f73ef6a017ee86ca89451a6271"><div class="ttname"><a href="namespaceMC.html#aad69f7f73ef6a017ee86ca89451a6271">MC::LocalConcentration</a></div><div class="ttdeci">Kokkos::Subview&lt; KernelConcentrationType, int, decltype(Kokkos::ALL)&gt; LocalConcentration</div><div class="ttdef"><b>Definition</b> alias.hpp:84</div></div>
<div class="ttc" id="anamespaceMC_html_ae36f8da8fd9f9f88aa5cff4f307cdc68"><div class="ttname"><a href="namespaceMC.html#ae36f8da8fd9f9f88aa5cff4f307cdc68">MC::ParticlesModel</a></div><div class="ttdeci">Kokkos::View&lt; F *[Nd], Kokkos::LayoutRight &gt; ParticlesModel</div><div class="ttdef"><b>Definition</b> alias.hpp:16</div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
